!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("blackswan",[],t):"object"==typeof exports?exports.blackswan=t():e.blackswan=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";var r;n.r(t),function(e){e[e.None=0]="None",e[e.Legato=1]="Legato",e[e.Staccato=2]="Staccato",e[e.Pianissimo=3]="Pianissimo",e[e.Piano=4]="Piano",e[e.MezzoPiano=5]="MezzoPiano",e[e.MezzoForte=6]="MezzoForte",e[e.Forte=7]="Forte",e[e.Fortissimo=8]="Fortissimo"}(r||(r={}));let i={[r.Pianissimo]:-3,[r.Piano]:-2,[r.MezzoPiano]:-1,[r.MezzoForte]:1,[r.Forte]:2,[r.Fortissimo]:3};function o(e){let t=e.length;return e[Math.floor(Math.random()*t)]}let s=function(e,t){let n=0,r=o(e.Config.durations),i=[];for(;n+r<t;){let t=o(e.Playables);if(Array.isArray(t)){let n=A.chord(t,r,...e.Config.style);i.push(n)}else{let n=A.note(t,r,...e.Config.style);i.push(n)}n+=r,r=o(e.Config.durations)}return i};let a={improvise:function(e,t){return s(e,t)},setImproviser:function(e){s=e}},u={FlatSigns:["b","@"],NoteMap:{a0:27.5,"a#0":29.1353,b0:30.8677,c1:32.7032,"c#1":34.6478,d1:36.7081,"d#1":38.8909,e1:41.2034,f1:43.6535,"f#1":46.2493,g1:48.9994,"g#1":51.9131,a1:55,"a#1":58.2705,b1:61.7354,c2:65.4064,"c#2":69.2957,d2:73.4162,"d#2":77.7817,e2:82.4069,f2:87.3071,"f#2":92.4986,g2:97.9989,"g#2":103.826,a2:110,"a#2":116.541,b2:123.471,c3:130.813,"c#3":138.591,d3:146.832,"d#3":155.563,e3:164.814,f3:174.614,"f#3":184.997,g3:195.998,"g#3":207.562,a3:220,"a#3":233.082,b3:246.942,c4:261.626,"c#4":277.183,d4:293.665,"d#4":311.127,e4:329.628,f4:349.228,"f#4":369.994,g4:391.995,"g#4":415.305,a4:440,"a#4":466.164,b4:493.883,c5:523.251,"c#5":554.365,d5:587.33,"d#5":622.254,e5:659.255,f5:698.456,"f#5":739.989,g5:783.991,"g#5":830.609,a5:880,"a#5":932.328,b5:987.767,c6:1046.5,"c#6":1108.73,d6:1174.66,"d#6":1244.51,e6:1318.51,f6:1396.91,"f#6":1479.98,g6:1567.98,"g#6":1661.22,a6:1760,"a#6":1864.66,b6:1975.53,c7:2093,"c#7":2217.46,d7:2349.32,"d#7":2489.02,e7:2637.02,f7:2793.83,"f#7":2959.96,g7:3135.96,"g#7":3322.44,a7:3520,"a#7":3729.31,b7:3951.07,c8:4186.01},Notes:["a","b","c","d","e","f","g"],SharpSigns:["#"]};let c={isTimedChord:function(e){return void 0!==e.Notes},isTimedNote:function(e){return void 0!==e.Note},Note:function(e){if(!~u.Notes.indexOf(e))throw Error(`"${e}" is not a valid note name between "a" and "g".`)},Octave:function(e){if(e=Number(e),isNaN(e))throw Error(`Invalid octave "${e}".`);if(e>8||e<0)throw Error("This octave is out of range (0 - 8) on a standard piano.")},Sign:function(e){if(!~u.FlatSigns.indexOf(e)&&!~u.SharpSigns.indexOf(e))throw Error(`Invalid sign "${e}".`)}};let l=4;function f(e){return c.Note(e),u.Notes.indexOf(e)}function h(e){let t=f(e);return t>0?u.Notes[t-1]:u.Notes[u.Notes.length-1]}let p={createNote:function(e,t,n=!1){if(!n&&u.NoteMap[e])throw Error(`\n      The note "${e}" already exists and cannot be overwritten unless\n      the 'overrideExisting' parameter is set to 'true'.`);u.NoteMap[e]=t},getFrequency:function(e){let t=u.NoteMap[e];if(t)return t;let n,r,i,o="";if(r=e[0].toLowerCase(),3===e.length)o=e[1],c.Sign(o),i=Number(e[2]),c.Octave(i);else if(2===e.length)~u.FlatSigns.indexOf(e[1])||~u.SharpSigns.indexOf(e[1])?(o=e[1],i=l):i=Number(e[1]);else{if(1!==e.length)throw Error(`Unrecognized note format "${e}".`);i=l}if(~"abdeg".indexOf(r)&&~u.FlatSigns.indexOf(o))return n=h(r)+"#"+i,u.NoteMap[n];if(~"cf".indexOf(r)&&~u.FlatSigns.indexOf(o))return n=h(r)+("c"===r?(i-1).toString():i.toString()),u.NoteMap[n];if(~"be".indexOf(r)&&~u.SharpSigns.indexOf(o))return n=function(e){let t=f(e);return t+1<u.Notes.length?u.Notes[t+1]:u.Notes[0]}(r)+("b"===r?(i+1).toString():i.toString()),u.NoteMap[n];{n=r+(o||"")+(i||"");let e=u.NoteMap[n];if(e)return e}throw Error(`The note "${e}" is unknown.`)},setOctave:function(e){c.Octave(e),l=Number(e)}};var d=new v(220.5);function v(e){e=Math.floor(e),this._array=new Float32Array(2*e),this.length=this._array.length,this.readPointer=0,this.writePointer=e-1;for(var t=0;t<this.length;t++)this._array[t]=0}v.prototype.read=function(){var e=this._array[this.readPointer%this.length];return this.readPointer++,e},v.prototype.push=function(e){this._array[this.writePointer%this.length]=e,this.writePointer++};var m=0,g=function(e){return Math.pow(10,e/20)},y=function(e){for(var t=e.inputBuffer.getChannelData(0),n=e.outputBuffer.getChannelData(0),r=g(0),i=g(0),o=0;o<t.length;++o)n[o]=i*t[o];for(var s=function(e,t,n,r){for(var i=Math.exp(-1/(r*t)),o=Math.exp(-1/(r*n)),s=new Float32Array(e.length),a=0;a<e.length;a++){var u=Math.abs(e[a]);m=m<u?u+i*(m-u):u+o*(m-u),s[a]=m}return s}(n,0,.05,44100),a=0;a<n.length;a++)d.push(n[a]),n[a]=d.read();var u;for(a=0;a<t.length;a++){var c=1*(-2-(u=s[a],20*Math.log10(u)));c=Math.min(0,c);var l=g(c);n[a]*=l*r}};let _=new AudioContext,b=_.createGain();b.gain.value=.7;let S=_.createScriptProcessor(4096,1,1);S.onaudioprocess=y,S.connect(_.destination),b.connect(S);let x=function(e,t,n){let r=_.createGain();r.gain.value=.2,t.some(e=>{let t=i[e];return!!t&&(r.gain.value+=.12*t,!0)});let o=Math.sqrt(e)/Math.sqrt(4200)*-.25+.125+.08;return o>0&&(o=Math.pow(o+1,3)-1),r.gain.value+=o,r.connect(n),r},w=function(e,t,n){let r=_.createOscillator();return r.frequency.value=e,r.type="sine",r.connect(n),r},T=function(e,t,n){let i=e.GetNodeChain(),o=n-t,s=.04,a=n;~e.Style.indexOf(r.Legato)?(s=.01,a=n):~e.Style.indexOf(r.Staccato)&&(s=.01,a=t+.15);let u=s*o,c=i.Gain.gain.value;i.Gain.gain.value=0,i.Gain.gain.setTargetAtTime(c,t,u),i.Gain.gain.setTargetAtTime(0,a-4*u,u),i.Oscillator.start(t),i.Oscillator.stop(a)};let N={Context:_,SetGain:function(e){x=e},SetOscillator:function(e){w=e},SetPlayer:function(e){T=e},SynthesizeNote:function(e,t){return{Frequency:e,GetNodeChain:function(){let n=x(e,t,b);return{Gain:n,Oscillator:w(e,t,n)}},Play:function(e,t){T(this,e,t)},Style:t}}};function M(e,t,n,r=0){let i=Math.max(t-r,0),o=Math.max(t+n-r,0);0!==o&&e.Play(i,o)}let O={play:function(e){void 0===e&&(e=N.Context.currentTime);for(let t of this._master)for(let n of t.Notes)M(n,t.WhenSeconds+e,t.DurationSeconds)}};const P=n(8);function k(e,t){let n=C(e,t);e.Song._master=e.Song._master.concat(n)}function L(e,t){return 60/t._metadata.Tempo*(e*t._metadata.TimeSignature.noteValue)}function E(e,t){let n=t._metadata.Tempo/60;return t._metadata.TimeSignature.beatsPerMeasure/n*e}function C(e,t){let n=E(e.Measure,e.Song);if(c.isTimedNote(t)){return[{Notes:[t.Note],DurationSeconds:L(t.Duration,e.Song),WhenSeconds:n}]}if(c.isTimedChord(t)){return[{Notes:t.Notes,DurationSeconds:L(t.Duration,e.Song),WhenSeconds:n}]}return t.map((o,s)=>{if(s>0&&(e.Measure+=(r=t[s-1].Duration,i=e.Song,r*(i._metadata.TimeSignature.noteValue/i._metadata.TimeSignature.beatsPerMeasure))),c.isTimedNote(o))return C(e,o);if(c.isTimedChord(o))return C(e,o);return[{Notes:[],DurationSeconds:L(o.Duration,e.Song),WhenSeconds:n}]}).reduce((e,t)=>e.concat(t),[]);var r,i}let F={GetActions:function(e,t){let n=N.Context,r=new P({context:n});r.start();let i={Measure:t,Song:e};return{callback:function(i){let o=E(t,e);r.insert(o+n.currentTime,i)},improvises:function(e,t){return function(e,t,n){k(e,a.improvise(t,n))}(i,e,t)},plays:function(e){return k(i,e)},repeats:function(e,t){return function(e,t,n){let r=[],i=C(e,t)[0];for(let t=0;t<n.times;t++){let o={Notes:i.Notes,DurationSeconds:i.DurationSeconds,WhenSeconds:i.WhenSeconds+t*L(n.every,e.Song)};r.push(o)}e.Song._master=e.Song._master.concat(r)}(i,e,t)}}}};var I=n(1);n.d(t,"blackswan",function(){return A});let A=function(e){function t(e){return F.GetActions(this,e)}function n(e,t){let n={beatsPerMeasure:e,noteValue:t};this._metadata.TimeSignature=n}function i(e){this._metadata.Tempo=e}let o={setGain:N.SetGain,setImproviser:a.setImproviser,setOscillator:N.SetOscillator,setPlayer:N.SetPlayer},s={as:r,chord:function(e,t,...n){return{Notes:e.map(e=>N.SynthesizeNote(p.getFrequency(e),n)),Duration:t}},note:function(e,t,...n){return{Duration:t,Note:N.SynthesizeNote(p.getFrequency(e),n)}},rest:function(e){return{Duration:e}},scale:function(e,t){return{Config:t||{durations:[.25],style:[]},Playables:e}},sequence:function(e){return e},settings:o,song:function(e){let r=Object(I.a)();return r.Title=e,{at:t,play:O.play,setTimeSignature:n,setTempo:i,_master:[],_metadata:r}}};return e.blackswan=s,s}(window);t.default=A},function(e,t,n){"use strict";n.d(t,"a",function(){return s});let r={beatsPerMeasure:4,noteValue:4},i=120,o="Unnamed";function s(){return{Tempo:i,TimeSignature:r,Title:o}}},function(e,t,n){"use strict";e.exports={get currentTime(){return Date.now()/1e3}}},function(e,t,n){"use strict";e.exports=function(e,t){return void 0!==e?e:t}},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,s,a,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(o(n=this._events[e]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(i(n))for(a=Array.prototype.slice.call(arguments,1),s=(c=n.slice()).length,u=0;u<s;u++)c[u].apply(this,a);return!0},n.prototype.addListener=function(e,t){var s;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(s=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){if(!r(t))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},n.prototype.removeListener=function(e,t){var n,o,s,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(n=this._events[e]).length,o=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(n)){for(a=s;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){o=a;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";(function(t){var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(4),o=n(3),s=n(2),a=function(e){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),e=e||{};var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r.context=o(e.context,s),r.interval=o(e.interval,.025),r.aheadTime=o(e.aheadTime,.1),r.timerAPI=o(e.timerAPI,t),r.playbackTime=r.currentTime,r._timerId=0,r._schedId=0,r._scheds=[],r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,i.EventEmitter),r(n,[{key:"start",value:function(e,t){var n=this.process.bind(this);return 0===this._timerId?(this._timerId=this.timerAPI.setInterval(n,1e3*this.interval),this.emit("start"),e&&(this.insert(this.context.currentTime,e,t),n())):e&&this.insert(this.context.currentTime,e,t),this}},{key:"stop",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return 0!==this._timerId&&(this.timerAPI.clearInterval(this._timerId),this._timerId=0,this.emit("stop")),e&&this._scheds.splice(0),this}},{key:"insert",value:function(e,t,n){var r=++this._schedId,i={id:r,time:e,callback:t,args:n},o=this._scheds;if(0===o.length||o[o.length-1].time<=e)o.push(i);else for(var s=0,a=o.length;s<a;s++)if(e<o[s].time){o.splice(s,0,i);break}return r}},{key:"nextTick",value:function(e,t,n){return"function"==typeof e&&(n=t,t=e,e=this.playbackTime),this.insert(e+this.aheadTime,t,n)}},{key:"remove",value:function(e){var t=this._scheds;if("number"==typeof e)for(var n=0,r=t.length;n<r;n++)if(e===t[n].id){t.splice(n,1);break}return e}},{key:"removeAll",value:function(){this._scheds.splice(0)}},{key:"process",value:function(){var e=this.context.currentTime,t=e+this.aheadTime;this._process(e,t)}},{key:"_process",value:function(e,t){var n=this._scheds,r=e;for(this.playbackTime=r,this.emit("process",{playbackTime:r});n.length&&n[0].time<t;){var i=n.shift(),o=i.time,s=i.args;this.playbackTime=o,i.callback({playbackTime:o,args:s})}this.playbackTime=r,this.emit("processed",{playbackTime:r})}},{key:"state",get:function(){return 0!==this._timerId?"running":"suspended"}},{key:"currentTime",get:function(){return this.context.currentTime}},{key:"events",get:function(){return this._scheds.slice()}}]),n}();e.exports=a}).call(this,n(5))},function(e,t,n){"use strict";e.exports=n(6)},function(e,t,n){e.exports=n(7)}])});