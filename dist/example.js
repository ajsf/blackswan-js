!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);let r={beatsPerMeasure:4,noteValue:4},i=120,o="Unnamed";var s;!function(e){e[e.None=0]="None",e[e.Legato=1]="Legato",e[e.Staccato=2]="Staccato",e[e.Pianissimo=3]="Pianissimo",e[e.Piano=4]="Piano",e[e.MezzoPiano=5]="MezzoPiano",e[e.MezzoForte=6]="MezzoForte",e[e.Forte=7]="Forte",e[e.Fortissimo=8]="Fortissimo"}(s||(s={}));let a={[s.Pianissimo]:-3,[s.Piano]:-2,[s.MezzoPiano]:-1,[s.MezzoForte]:1,[s.Forte]:2,[s.Fortissimo]:3};function c(e){let t=e.length;return e[Math.floor(Math.random()*t)]}let u=function(e,t){let n=0,r=c(e.Config.durations),i=[];for(;n+r<t;){let t=c(e.Playables);if(Array.isArray(t)){let n=q.chord(t,r,...e.Config.style);i.push(n)}else{let n=q.note(t,r,...e.Config.style);i.push(n)}n+=r,r=c(e.Config.durations)}return i};let l={improvise:function(e,t){return u(e,t)},setImproviser:function(e){u=e}},h={FlatSigns:["b","@"],NoteMap:{a0:27.5,"a#0":29.1353,b0:30.8677,c1:32.7032,"c#1":34.6478,d1:36.7081,"d#1":38.8909,e1:41.2034,f1:43.6535,"f#1":46.2493,g1:48.9994,"g#1":51.9131,a1:55,"a#1":58.2705,b1:61.7354,c2:65.4064,"c#2":69.2957,d2:73.4162,"d#2":77.7817,e2:82.4069,f2:87.3071,"f#2":92.4986,g2:97.9989,"g#2":103.826,a2:110,"a#2":116.541,b2:123.471,c3:130.813,"c#3":138.591,d3:146.832,"d#3":155.563,e3:164.814,f3:174.614,"f#3":184.997,g3:195.998,"g#3":207.562,a3:220,"a#3":233.082,b3:246.942,c4:261.626,"c#4":277.183,d4:293.665,"d#4":311.127,e4:329.628,f4:349.228,"f#4":369.994,g4:391.995,"g#4":415.305,a4:440,"a#4":466.164,b4:493.883,c5:523.251,"c#5":554.365,d5:587.33,"d#5":622.254,e5:659.255,f5:698.456,"f#5":739.989,g5:783.991,"g#5":830.609,a5:880,"a#5":932.328,b5:987.767,c6:1046.5,"c#6":1108.73,d6:1174.66,"d#6":1244.51,e6:1318.51,f6:1396.91,"f#6":1479.98,g6:1567.98,"g#6":1661.22,a6:1760,"a#6":1864.66,b6:1975.53,c7:2093,"c#7":2217.46,d7:2349.32,"d#7":2489.02,e7:2637.02,f7:2793.83,"f#7":2959.96,g7:3135.96,"g#7":3322.44,a7:3520,"a#7":3729.31,b7:3951.07,c8:4186.01},Notes:["a","b","c","d","e","f","g"],SharpSigns:["#"]};let f={isTimedChord:function(e){return void 0!==e.Notes},isTimedNote:function(e){return void 0!==e.Note},Note:function(e){if(!~h.Notes.indexOf(e))throw Error(`"${e}" is not a valid note name between "a" and "g".`)},Octave:function(e){if(e=Number(e),isNaN(e))throw Error(`Invalid octave "${e}".`);if(e>8||e<0)throw Error("This octave is out of range (0 - 8) on a standard piano.")},Sign:function(e){if(!~h.FlatSigns.indexOf(e)&&!~h.SharpSigns.indexOf(e))throw Error(`Invalid sign "${e}".`)}};let p=4;function d(e){return f.Note(e),h.Notes.indexOf(e)}function m(e){let t=d(e);return t>0?h.Notes[t-1]:h.Notes[h.Notes.length-1]}let v={createNote:function(e,t,n=!1){if(!n&&h.NoteMap[e])throw Error(`\n      The note "${e}" already exists and cannot be overwritten unless\n      the 'overrideExisting' parameter is set to 'true'.`);h.NoteMap[e]=t},getFrequency:function(e){let t=h.NoteMap[e];if(t)return t;let n,r,i,o="";if(r=e[0].toLowerCase(),3===e.length)o=e[1],f.Sign(o),i=Number(e[2]),f.Octave(i);else if(2===e.length)~h.FlatSigns.indexOf(e[1])||~h.SharpSigns.indexOf(e[1])?(o=e[1],i=p):i=Number(e[1]);else{if(1!==e.length)throw Error(`Unrecognized note format "${e}".`);i=p}if(~"abdeg".indexOf(r)&&~h.FlatSigns.indexOf(o))return n=m(r)+"#"+i,h.NoteMap[n];if(~"cf".indexOf(r)&&~h.FlatSigns.indexOf(o))return n=m(r)+("c"===r?(i-1).toString():i.toString()),h.NoteMap[n];if(~"be".indexOf(r)&&~h.SharpSigns.indexOf(o))return n=function(e){let t=d(e);return t+1<h.Notes.length?h.Notes[t+1]:h.Notes[0]}(r)+("b"===r?(i+1).toString():i.toString()),h.NoteMap[n];{n=r+(o||"")+(i||"");let e=h.NoteMap[n];if(e)return e}throw Error(`The note "${e}" is unknown.`)},setOctave:function(e){f.Octave(e),p=Number(e)}};var g=new y(220.5);function y(e){e=Math.floor(e),this._array=new Float32Array(2*e),this.length=this._array.length,this.readPointer=0,this.writePointer=e-1;for(var t=0;t<this.length;t++)this._array[t]=0}y.prototype.read=function(){var e=this._array[this.readPointer%this.length];return this.readPointer++,e},y.prototype.push=function(e){this._array[this.writePointer%this.length]=e,this.writePointer++};var _=0,b=function(e){return Math.pow(10,e/20)},S=function(e){for(var t=e.inputBuffer.getChannelData(0),n=e.outputBuffer.getChannelData(0),r=b(0),i=b(0),o=0;o<t.length;++o)n[o]=i*t[o];for(var s=function(e,t,n,r){for(var i=Math.exp(-1/(r*t)),o=Math.exp(-1/(r*n)),s=new Float32Array(e.length),a=0;a<e.length;a++){var c=Math.abs(e[a]);_=_<c?c+i*(_-c):c+o*(_-c),s[a]=_}return s}(n,0,.05,44100),a=0;a<n.length;a++)g.push(n[a]),n[a]=g.read();var c;for(a=0;a<t.length;a++){var u=1*(-2-(c=s[a],20*Math.log10(c)));u=Math.min(0,u);var l=b(u);n[a]*=l*r}};let T=new AudioContext,x=T.createGain();x.gain.value=.7;let w=T.createScriptProcessor(4096,1,1);w.onaudioprocess=S,w.connect(T.destination),x.connect(w);let N=function(e,t,n){let r=T.createGain();r.gain.value=.2,t.some(e=>{let t=a[e];return!!t&&(r.gain.value+=.12*t,!0)});let i=Math.sqrt(e)/Math.sqrt(4200)*-.25+.125+.08;return i>0&&(i=Math.pow(i+1,3)-1),r.gain.value+=i,r.connect(n),r},M=function(e,t,n){let r=T.createOscillator();return r.frequency.value=e,r.type="sine",r.connect(n),r},P=function(e,t,n){let r=e.GetNodeChain(),i=n-t,o=.04,a=n;~e.Style.indexOf(s.Legato)?(o=.01,a=n):~e.Style.indexOf(s.Staccato)&&(o=.01,a=t+.15);let c=o*i,u=r.Gain.gain.value;r.Gain.gain.value=0,r.Gain.gain.setTargetAtTime(u,t,c),r.Gain.gain.setTargetAtTime(0,a-4*c,c),r.Oscillator.start(t),r.Oscillator.stop(a)};let O={Context:T,SetGain:function(e){N=e},SetOscillator:function(e){M=e},SetPlayer:function(e){P=e},SynthesizeNote:function(e,t){return{Frequency:e,GetNodeChain:function(){if(this._nodeChain)return this._nodeChain;let n=N(e,t,x),r={Gain:n,Oscillator:M(e,t,n)};return this._nodeChain=r,this._nodeChain},Play:function(e,t){P(this,e,t)},Stop:function(){this.GetNodeChain().Oscillator.stop()},Style:t,_nodeChain:null}}};function L(e,t,n,r=0){let i=Math.max(t-r,0),o=Math.max(t+n-r,0);0!==o&&e.Play(i,o)}let k={play:function(e){void 0===e&&(e=O.Context.currentTime);for(let t of this._master)for(let n of t.Notes)L(n,t.WhenSeconds+e,t.DurationSeconds)},stop:function(){for(let e of this._master)for(let t of e.Notes)t.Stop()}};const C=n(7);function F(e,t){let n=A(e,t);e.Song._master=e.Song._master.concat(n)}function E(e,t){return 60/t._metadata.Tempo*(e*t._metadata.TimeSignature.noteValue)}function z(e,t){let n=t._metadata.Tempo/60;return t._metadata.TimeSignature.beatsPerMeasure/n*e}function A(e,t){let n=z(e.Measure,e.Song);if(f.isTimedNote(t)){return[{Notes:[t.Note],DurationSeconds:E(t.Duration,e.Song),WhenSeconds:n}]}if(f.isTimedChord(t)){return[{Notes:t.Notes,DurationSeconds:E(t.Duration,e.Song),WhenSeconds:n}]}return t.map((o,s)=>{if(s>0&&(e.Measure+=(r=t[s-1].Duration,i=e.Song,r*(i._metadata.TimeSignature.noteValue/i._metadata.TimeSignature.beatsPerMeasure))),f.isTimedNote(o))return A(e,o);if(f.isTimedChord(o))return A(e,o);return[{Notes:[],DurationSeconds:E(o.Duration,e.Song),WhenSeconds:n}]}).reduce((e,t)=>e.concat(t),[]);var r,i}let I={GetActions:function(e,t){let n=O.Context,r=new C({context:n});r.start();let i={Measure:t,Song:e};return{callback:function(i){let o=z(t,e);r.insert(o+n.currentTime,i)},improvises:function(e,t){return function(e,t,n){F(e,l.improvise(t,n))}(i,e,t)},plays:function(e){return F(i,e)},repeats:function(e,t){return function(e,t,n){let r=[],i=A(e,t)[0];for(let t=0;t<n.times;t++){let o={Notes:i.Notes,DurationSeconds:i.DurationSeconds,WhenSeconds:i.WhenSeconds+t*E(n.every,e.Song)};r.push(o)}e.Song._master=e.Song._master.concat(r)}(i,e,t)}}}},q=function(e){function t(e){return I.GetActions(this,e)}function n(e,t){let n={beatsPerMeasure:e,noteValue:t};this._metadata.TimeSignature=n}function a(e){this._metadata.Tempo=e}let c={setGain:O.SetGain,setImproviser:l.setImproviser,setOscillator:O.SetOscillator,setPlayer:O.SetPlayer},u={as:s,chord:function(e,t,...n){return{Notes:e.map(e=>O.SynthesizeNote(v.getFrequency(e),n)),Duration:t}},note:function(e,t,...n){return{Duration:t,Note:O.SynthesizeNote(v.getFrequency(e),n)}},rest:function(e){return{Duration:e}},scale:function(e,t){return{Config:t||{durations:[.25],style:[]},Playables:e}},sequence:function(e){return e},settings:c,song:function(e){let s={Tempo:i,TimeSignature:r,Title:o};return s.Title=e,{at:t,play:k.play,stop:k.stop,setTimeSignature:n,setTempo:a,_master:[],_metadata:s}}};return e.blackswan=u,u}(window);q.song("one note").at(0).plays(q.note("c4",1));let D=q.song("sequence"),G=q.sequence([q.note("c4",.25),q.note("d4",.25),q.note("e4",.25),q.rest(.25),q.note("f4",.25)]);D.at(0).plays(G);let j=q.song("chords"),W=q.sequence([q.chord(["c4","e4","g4"],.25),q.chord(["d4","f4","a4"],.25),q.chord(["e4","g4","b4"],.25),q.rest(.25),q.chord(["f4","a4","c5"],.25)]);j.at(0).plays(W);let $=q.song("repeats"),U=q.note("c4",.25),V=q.chord(["e4","g4"],.25);$.at(0).repeats(U,{every:.25,times:4}),$.at(.25).repeats(V,{every:.25,times:2});let B=q.song("improvise"),R=q.scale(["c4","e4","f4","g4","c5",["e4","g4"]],{durations:[.25,.25,.5],style:[]});B.at(0).improvises(R,4);let H=q.song("La Cucaracha");H.setTempo(200);let J=q.note("c4",1/8),K=J,Q=K,X=q.note("f4",3/8),Y=q.note("a4",.25),Z=q.note("f4",.25),ee=q.note("f4",1/8),te=q.note("e4",1/8),ne=te,re=q.note("d4",1/8),ie=re,oe=q.note("c4",3/8),se=q.sequence([J,K,Q,X,Y,J,K,Q,X,Y,q.rest(3/8),Z,ee,te,ne,re,ie,oe]);H.at(0).plays(se);let ae=q.song("legato and staccato"),ce=q.sequence([q.note("c4",.25,q.as.Staccato),q.note("e4",.25,q.as.Staccato),q.note("c4",.25,q.as.Staccato)]),ue=q.sequence([q.chord(["c4","f4","g4"],.25,q.as.Legato),q.chord(["c4","e4","g4"],.25,q.as.Legato)]);ae.at(0).plays(ce),ae.at(.75).plays(ue);let le=q.song("glissandos");function he(e){return["c","d","e","f","g","a","b"].map(t=>t+e)}let fe=he(1).concat(he(2)).concat(he(3)),pe=he(4).concat(he(5)),de=he(6).concat(he(7));function me(e){let t=[];for(let n of e)t.push(q.note(n,3/80));return q.sequence(t)}le.at(0).plays(me(fe)),le.at(1).plays(me(pe)),le.at(2).plays(me(de)),q.song("dynamics").at(0).plays(q.sequence([q.note("a4",.25,q.as.Pianissimo),q.note("a4",.25,q.as.Piano),q.note("a4",.25,q.as.MezzoPiano),q.note("a4",.25,q.as.MezzoForte),q.note("a4",.25,q.as.Forte),q.note("a4",.25,q.as.Fortissimo)])),q.song("strange notes").at(0).plays(q.sequence([q.note("c",.25),q.note("c#",.25),q.note("c@4",.25),q.note("cb4",.25),q.note("A5",.25),q.note("b#",.25)]));let ve=q.song("play then stop");ve.at(0).plays(q.note("c4",16)),ve.at(1).callback(()=>{ve.stop()});let ge=q.song("metronome");ge.setTempo(120),ge.setTimeSignature(4,4),ge.at(0).repeats(q.note("a3",.25),{every:.5,times:20}),ge.at(.25).repeats(q.note("a4",.25),{every:.5,times:20}),q.song("improvise with default settings").at(0).improvises(q.scale(["a4","b4","c5","e5"]),4),ve.play()},function(e,t,n){"use strict";e.exports={get currentTime(){return Date.now()/1e3}}},function(e,t,n){"use strict";e.exports=function(e,t){return void 0!==e?e:t}},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,s,a,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(o(n=this._events[e]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(i(n))for(a=Array.prototype.slice.call(arguments,1),s=(u=n.slice()).length,c=0;c<s;c++)u[c].apply(this,a);return!0},n.prototype.addListener=function(e,t){var s;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(s=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){if(!r(t))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},n.prototype.removeListener=function(e,t){var n,o,s,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(n=this._events[e]).length,o=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(n)){for(a=s;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){o=a;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";(function(t){var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=n(3),o=n(2),s=n(1),a=function(e){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),e=e||{};var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r.context=o(e.context,s),r.interval=o(e.interval,.025),r.aheadTime=o(e.aheadTime,.1),r.timerAPI=o(e.timerAPI,t),r.playbackTime=r.currentTime,r._timerId=0,r._schedId=0,r._scheds=[],r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,i.EventEmitter),r(n,[{key:"start",value:function(e,t){var n=this.process.bind(this);return 0===this._timerId?(this._timerId=this.timerAPI.setInterval(n,1e3*this.interval),this.emit("start"),e&&(this.insert(this.context.currentTime,e,t),n())):e&&this.insert(this.context.currentTime,e,t),this}},{key:"stop",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return 0!==this._timerId&&(this.timerAPI.clearInterval(this._timerId),this._timerId=0,this.emit("stop")),e&&this._scheds.splice(0),this}},{key:"insert",value:function(e,t,n){var r=++this._schedId,i={id:r,time:e,callback:t,args:n},o=this._scheds;if(0===o.length||o[o.length-1].time<=e)o.push(i);else for(var s=0,a=o.length;s<a;s++)if(e<o[s].time){o.splice(s,0,i);break}return r}},{key:"nextTick",value:function(e,t,n){return"function"==typeof e&&(n=t,t=e,e=this.playbackTime),this.insert(e+this.aheadTime,t,n)}},{key:"remove",value:function(e){var t=this._scheds;if("number"==typeof e)for(var n=0,r=t.length;n<r;n++)if(e===t[n].id){t.splice(n,1);break}return e}},{key:"removeAll",value:function(){this._scheds.splice(0)}},{key:"process",value:function(){var e=this.context.currentTime,t=e+this.aheadTime;this._process(e,t)}},{key:"_process",value:function(e,t){var n=this._scheds,r=e;for(this.playbackTime=r,this.emit("process",{playbackTime:r});n.length&&n[0].time<t;){var i=n.shift(),o=i.time,s=i.args;this.playbackTime=o,i.callback({playbackTime:o,args:s})}this.playbackTime=r,this.emit("processed",{playbackTime:r})}},{key:"state",get:function(){return 0!==this._timerId?"running":"suspended"}},{key:"currentTime",get:function(){return this.context.currentTime}},{key:"events",get:function(){return this._scheds.slice()}}]),n}();e.exports=a}).call(this,n(4))},function(e,t,n){"use strict";e.exports=n(5)},function(e,t,n){e.exports=n(6)}]);